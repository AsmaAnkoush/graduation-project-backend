<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

  <!-- جدول ai_analyzer -->
  <changeSet id="1" author="smartvax">
    <createTable tableName="ai_analyzer">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="analysis_result" type="VARCHAR(255)"/>
      <column name="feedback_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="ai_analyzer" baseColumnNames="feedback_id"
                             referencedTableName="feedback" referencedColumnNames="id"
                             constraintName="fk_ai_analyzer_feedback"/>
  </changeSet>

  <!-- جدول appointment -->
  <changeSet id="2" author="smartvax">
    <createTable tableName="appointment">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="appointment_date" type="DATETIME(6)" nullable="false"/>
      <column name="status" type="VARCHAR(255)" nullable="false"/>
      <column name="parent_id" type="BIGINT"/>
      <column name="child_id" type="VARCHAR(50)"/>
      <column name="schedule_id" type="BIGINT"/>
      <column name="health_worker_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="appointment" baseColumnNames="parent_id"
                             referencedTableName="parent" referencedColumnNames="id"
                             constraintName="fk_appointment_parent"/>
    <addForeignKeyConstraint baseTableName="appointment" baseColumnNames="child_id"
                             referencedTableName="child" referencedColumnNames="id"
                             constraintName="fk_appointment_child"/>
    <addForeignKeyConstraint baseTableName="appointment" baseColumnNames="schedule_id"
                             referencedTableName="schedule_vaccination" referencedColumnNames="id"
                             constraintName="fk_appointment_schedule"/>
    <addForeignKeyConstraint baseTableName="appointment" baseColumnNames="health_worker_id"
                             referencedTableName="health_worker" referencedColumnNames="id"
                             constraintName="fk_appointment_health_worker"/>
  </changeSet>

  <!-- جدول child -->
  <changeSet id="3" author="smartvax">
    <createTable tableName="child">
      <column name="id" type="VARCHAR(50)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="dob" type="DATE" nullable="false"/>
      <column name="weight" type="DECIMAL(21,2)"/>
      <column name="height" type="DECIMAL(21,2)"/>
      <column name="health_record_id" type="BIGINT"/>
      <column name="parent_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="child" baseColumnNames="parent_id"
                             referencedTableName="parent" referencedColumnNames="id"
                             constraintName="fk_child_parent"/>
    <addForeignKeyConstraint baseTableName="child" baseColumnNames="health_record_id"
                             referencedTableName="health_record" referencedColumnNames="id"
                             constraintName="fk_child_health_record"/>
  </changeSet>

  <!-- جدول civil_affairs_children -->
  <changeSet id="4" author="smartvax">
    <createTable tableName="civil_affairs_children">
      <column name="id" type="VARCHAR(50)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="dob" type="DATE" nullable="false"/>
      <column name="gender" type="VARCHAR(10)"/>
      <column name="parent_phone" type="VARCHAR(20)"/>
    </createTable>
  </changeSet>

  <!-- جدول feedback -->
  <changeSet id="5" author="smartvax">
    <createTable tableName="feedback">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="message_text" type="VARCHAR(255)" nullable="false"/>
      <column name="side_effects" type="VARCHAR(255)"/>
      <column name="treatment" type="VARCHAR(255)"/>
      <column name="date_submitted" type="DATETIME(6)"/>
      <column name="parent_id" type="BIGINT"/>
      <column name="vaccination_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="feedback" baseColumnNames="parent_id"
                             referencedTableName="parent" referencedColumnNames="id"
                             constraintName="fk_feedback_parent"/>
    <addForeignKeyConstraint baseTableName="feedback" baseColumnNames="vaccination_id"
                             referencedTableName="vaccination" referencedColumnNames="id"
                             constraintName="fk_feedback_vaccination"/>
  </changeSet>

  <!-- جدول health_center -->
  <changeSet id="6" author="smartvax">
    <createTable tableName="health_center">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="location" type="VARCHAR(255)"/>
      <column name="status" type="VARCHAR(50)"/>
    </createTable>
  </changeSet>

  <!-- جدول health_record -->
  <changeSet id="7" author="smartvax">
    <createTable tableName="health_record">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="sensitivity" type="VARCHAR(255)"/>
      <column name="diabetes" type="BIT(1)"/>
      <column name="high_blood_pressure" type="BIT(1)"/>
      <column name="genetic_diseases" type="VARCHAR(255)"/>
      <column name="blood_type" type="VARCHAR(255)"/>
    </createTable>
  </changeSet>

  <!-- جدول health_worker -->
  <changeSet id="8" author="smartvax">
    <createTable tableName="health_worker">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="username" type="VARCHAR(255)" nullable="false" unique="true"/>
      <column name="password" type="VARCHAR(255)" nullable="false"/>
      <column name="phone" type="VARCHAR(255)" nullable="false" unique="true"/>
      <column name="age" type="INT"/>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="gender" type="VARCHAR(255)"/>
      <column name="location" type="VARCHAR(255)"/>
      <column name="email" type="VARCHAR(255)" nullable="false" unique="true"/>
      <column name="role" type="VARCHAR(255)" nullable="false"/>
      <column name="center_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="health_worker" baseColumnNames="center_id"
                             referencedTableName="health_center" referencedColumnNames="id"
                             constraintName="fk_health_worker_center"/>
  </changeSet>

  <!-- جدول jhi_authority -->
  <changeSet id="9" author="smartvax">
    <createTable tableName="jhi_authority">
      <column name="name" type="VARCHAR(50)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
    </createTable>
  </changeSet>

  <!-- جدول jhi_user -->
  <changeSet id="10" author="smartvax">
    <createTable tableName="jhi_user">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="login" type="VARCHAR(50)" nullable="false" unique="true"/>
      <column name="password_hash" type="VARCHAR(60)" nullable="false"/>
      <column name="first_name" type="VARCHAR(50)"/>
      <column name="last_name" type="VARCHAR(50)"/>
      <column name="email" type="VARCHAR(254)" unique="true"/>
      <column name="image_url" type="VARCHAR(256)"/>
      <column name="activated" type="BIT(1)" nullable="false"/>
      <column name="lang_key" type="VARCHAR(10)"/>
      <column name="activation_key" type="VARCHAR(20)"/>
      <column name="reset_key" type="VARCHAR(20)"/>
      <column name="created_by" type="VARCHAR(50)" nullable="false"/>
      <column name="created_date" type="TIMESTAMP"/>
      <column name="reset_date" type="TIMESTAMP"/>
      <column name="last_modified_by" type="VARCHAR(50)"/>
      <column name="last_modified_date" type="TIMESTAMP"/>
    </createTable>
  </changeSet>

  <!-- جدول jhi_user_authority -->
  <changeSet id="11" author="smartvax">
    <createTable tableName="jhi_user_authority">
      <column name="user_id" type="BIGINT">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="authority_name" type="VARCHAR(50)">
        <constraints primaryKey="true" nullable="false"/>
      </column>
    </createTable>
    <addForeignKeyConstraint baseTableName="jhi_user_authority" baseColumnNames="user_id"
                             referencedTableName="jhi_user" referencedColumnNames="id"
                             constraintName="fk_user_authority_user"/>
    <addForeignKeyConstraint baseTableName="jhi_user_authority" baseColumnNames="authority_name"
                             referencedTableName="jhi_authority" referencedColumnNames="name"
                             constraintName="fk_user_authority_authority"/>
  </changeSet>

  <!-- جدول parent -->
  <changeSet id="12" author="smartvax">
    <createTable tableName="parent">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="phone" type="VARCHAR(255)" nullable="false" unique="true"/>
      <column name="dob" type="DATE"/>
      <column name="role" type="VARCHAR(255)" nullable="false"/>
      <column name="user_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="parent" baseColumnNames="user_id"
                             referencedTableName="jhi_user" referencedColumnNames="id"
                             constraintName="fk_parent_user"/>
  </changeSet>

  <!-- جدول reminder -->
  <changeSet id="13" author="smartvax">
    <createTable tableName="reminder">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="message_text" type="VARCHAR(255)" nullable="false"/>
      <column name="appointment_id" type="BIGINT"/>
      <column name="recipient_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="reminder" baseColumnNames="appointment_id"
                             referencedTableName="appointment" referencedColumnNames="id"
                             constraintName="fk_reminder_appointment"/>
    <addForeignKeyConstraint baseTableName="reminder" baseColumnNames="recipient_id"
                             referencedTableName="health_worker" referencedColumnNames="id"
                             constraintName="fk_reminder_recipient"/>
  </changeSet>

  <!-- جدول schedule_vaccination -->
  <changeSet id="14" author="smartvax">
    <createTable tableName="schedule_vaccination">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="scheduled_date" type="DATE" nullable="false"/>
      <column name="status" type="VARCHAR(255)" nullable="false"/>
      <column name="child_id" type="VARCHAR(50)"/>
      <column name="vaccination_id" type="BIGINT"/>
    </createTable>
    <addForeignKeyConstraint baseTableName="schedule_vaccination" baseColumnNames="child_id"
                             referencedTableName="child" referencedColumnNames="id"
                             constraintName="fk_schedule_child"/>
    <addForeignKeyConstraint baseTableName="schedule_vaccination" baseColumnNames="vaccination_id"
                             referencedTableName="vaccination" referencedColumnNames="id"
                             constraintName="fk_schedule_vaccination"/>
  </changeSet>

  <!-- جدول users -->
  <changeSet id="15" author="smartvax">
    <createTable tableName="users">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="username" type="VARCHAR(100)" nullable="false" unique="true"/>
      <column name="password" type="VARCHAR(255)" nullable="false"/>
      <column name="role" type="VARCHAR(50)" nullable="false"/>
    </createTable>
  </changeSet>

  <!-- جدول vaccination -->
  <changeSet id="16" author="smartvax">
    <createTable tableName="vaccination">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>
      <column name="name" type="VARCHAR(255)" nullable="false"/>
      <column name="type" type="VARCHAR(255)"/>
      <column name="side_effects" type="VARCHAR(255)"/>
      <column name="target_age" type="INT"/>
      <column name="status" type="VARCHAR(255)" nullable="false"/>
      <column name="treatment" type="VARCHAR(255)"/>
    </createTable>
  </changeSet>

</databaseChangeLog>
